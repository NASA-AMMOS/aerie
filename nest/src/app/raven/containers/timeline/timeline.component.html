<as-split direction="horizontal" gutterSize="7" (dragEnd)="resize()">
  <as-split-area [visible]="showLeftPanel$ | async" [order]="0" size="25">
    <app-source-explorer></app-source-explorer>
  </as-split-area>

  <as-split-area [order]="1" [size]="timelinePanelSize$ | async">
    <as-split direction="vertical" gutterSize="7" (dragEnd)="resize()">
      <as-split-area [order]="3" [size]="getMainChartHeightPercent()">
        <ng-container *ngIf="itarMessage$ | async as itarMessage">
          <div *ngIf="itarMessage !== ''" class="itar-message">
            <mat-card>
              {{ itarMessage }}
            </mat-card>
          </div>
        </ng-container>

        <div *ngIf="bands.length === 0" class="get-started">
          <mat-card>
            To get started, select some
            <i
              class="fa fa-area-chart"
              style="color: #17a923"
              aria-hidden="true"
            ></i>
            Data Sources from the source explorer.
          </mat-card>
        </div>

        <div *ngIf="bands.length > 0" class="north-container">
          <div class="time-bands-container">
            <raven-manage-graph
              [currentStateChanged]="currentStateChanged$ | async"
              [currentStateId]="currentStateId$ | async"
              [guides]="guides$ | async"
              [mode]="mode$ | async"
              (applyCurrentLayout)="onApplyCurrentLayout()"
              (applyCurrentState)="onApplyCurrentState()"
              (panToLeft)="onPanLeft()"
              (panToRight)="onPanRight()"
              (panTo)="onPanTo($event)"
              (removeAllBands)="onRemoveAllBands()"
              (removeAllGuides)="onRemoveAllGuides()"
              (resetView)="onResetView()"
              (shareableLink)="onShareableLink()"
              (updateCurrentState)="onUpdateCurrentState()"
              (zoomIn)="onZoomIn()"
              (zoomOut)="onZoomOut()"
            >
            </raven-manage-graph>
            <div>
              <raven-guide-band
                class="row"
                [guides]="guides$ | async"
                [labelFontSize]="(defaultBandSettings$ | async).labelFontSize"
                [labelWidth]="(defaultBandSettings$ | async).labelWidth"
                [lastClickTime]="lastClickTime$ | async"
                [maxTimeRange]="maxTimeRange$ | async"
                [showLastClick]="(defaultBandSettings$ | async).showLastClick"
                [viewTimeRange]="viewTimeRange$ | async"
                (toggleGuide)="onToggleGuide($event)"
              >
              </raven-guide-band>
            </div>
            <div>
              <raven-time-scroll-bar
                class="row"
                [labelWidth]="(defaultBandSettings$ | async).labelWidth"
                [maxTimeRange]="maxTimeRange$ | async"
                [viewTimeRange]="viewTimeRange$ | async"
                (updateViewTimeRange)="onUpdateViewTimeRange($event)"
              >
              </raven-time-scroll-bar>
            </div>
            <div>
              <raven-time-band
                class="row"
                [cursorColor]="cursorColor$ | async"
                [cursorTime]="cursorTime$ | async"
                [cursorWidth]="cursorWidth$ | async"
                [dayCode]="dayCode$ | async"
                [earthSecToEpochSec]="earthSecToEpochSec$ | async"
                [epoch]="inUseEpoch$ | async"
                [guides]="guides$ | async"
                [labelWidth]="(defaultBandSettings$ | async).labelWidth"
                [maxTimeRange]="maxTimeRange$ | async"
                [showTooltip]="(defaultBandSettings$ | async).showTooltip"
                [viewTimeRange]="viewTimeRange$ | async"
                (updateViewTimeRange)="onUpdateViewTimeRange($event)"
              >
              </raven-time-band>
            </div>
          </div>

          <div class="timeline-0">
            <raven-bands
              class="raven-bands-0"
              [cursorColor]="cursorColor$ | async"
              [cursorTime]="cursorTime$ | async"
              [cursorWidth]="cursorWidth$ | async"
              [bands]="bands"
              [containerId]="'0'"
              [dayCode]="dayCode$ | async"
              [earthSecToEpochSec]="earthSecToEpochSec$ | async"
              [epoch]="inUseEpoch$ | async"
              [excludeActivityTypes]="excludeActivityTypes$ | async"
              [guides]="guides$ | async"
              [hoveredBandId]="hoveredBandId$ | async"
              [labelFontSize]="(defaultBandSettings$ | async).labelFontSize"
              [labelWidth]="(defaultBandSettings$ | async).labelWidth"
              [lastClickTime]="lastClickTime$ | async"
              [maxTimeRange]="maxTimeRange$ | async"
              [selectedBandId]="selectedBandId$ | async"
              [selectedPoint]="selectedPoint$ | async"
              [showLastClick]="(defaultBandSettings$ | async).showLastClick"
              [showTooltip]="(defaultBandSettings$ | async).showTooltip"
              [viewTimeRange]="viewTimeRange$ | async"
              (addDivider)="onAddDividerBand($event)"
              (bandLeftClick)="onBandLeftClick($event)"
              (deleteBand)="onDeleteBand($event)"
              (hoverBand)="onHoverBand($event)"
              (newSort)="onSort($event)"
              (settingsBand)="onSettingsBand($event)"
              (updateAddTo)="onUpdateAddTo($event)"
              (updateOverlay)="onUpdateOverlay($event)"
              (updateViewTimeRange)="onUpdateViewTimeRange($event)"
            >
            </raven-bands>
          </div>
        </div>
      </as-split-area>

      <as-split-area
        [visible]="showSouthBandsPanel$ | async"
        [size]="southPanelHeight"
      >
        <div class="south-container">
          <div class="timeline-1">
            <raven-bands
              class="raven-bands-1"
              [cursorColor]="cursorColor$ | async"
              [cursorTime]="cursorTime$ | async"
              [cursorWidth]="cursorWidth$ | async"
              [bands]="bands"
              [containerId]="'1'"
              [dayCode]="dayCode$ | async"
              [earthSecToEpochSec]="earthSecToEpochSec$ | async"
              [epoch]="inUseEpoch$ | async"
              [excludeActivityTypes]="excludeActivityTypes$ | async"
              [guides]="guides$ | async"
              [hoveredBandId]="hoveredBandId$ | async"
              [labelFontSize]="(defaultBandSettings$ | async).labelFontSize"
              [labelWidth]="(defaultBandSettings$ | async).labelWidth"
              [lastClickTime]="lastClickTime$ | async"
              [maxTimeRange]="maxTimeRange$ | async"
              [selectedBandId]="selectedBandId$ | async"
              [selectedPoint]="selectedPoint$ | async"
              [showLastClick]="(defaultBandSettings$ | async).showLastClick"
              [showTooltip]="(defaultBandSettings$ | async).showTooltip"
              [viewTimeRange]="viewTimeRange$ | async"
              (addDivider)="onAddDividerBand($event)"
              (bandLeftClick)="onBandLeftClick($event)"
              (deleteBand)="onDeleteBand($event)"
              (hoverBand)="onHoverBand($event)"
              (newSort)="onSort($event)"
              (settingsBand)="onSettingsBand($event)"
              (updateAddTo)="onUpdateAddTo($event)"
              (updateOverlay)="onUpdateOverlay($event)"
              (updateViewTimeRange)="onUpdateViewTimeRange($event)"
            >
            </raven-bands>
          </div>
        </div>
      </as-split-area>

      <as-split-area
        [visible]="showDetailsPanel$ | async"
        [order]="5"
        [size]="detailsPanelHeight"
      >
        <raven-table
          class="raven-table"
          [activityFilter]="(selectedSubBand$ | async)?.activityFilter"
          [activityInitiallyHidden]="
            (defaultBandSettings$ | async).activityInitiallyHidden
          "
          [points]="selectedSubBandPoints$ | async"
          [selectedBandId]="selectedBandId$ | async"
          [selectedSubBand]="selectedSubBand$ | async"
          [selectedPoint]="selectedPoint$ | async"
          (updateFilter)="onUpdateSubBand($event)"
          (updateFilterActivityInSubBand)="onFilterActivityInSubBand($event)"
          (updateTableColumns)="onUpdateSubBand($event)"
        >
        </raven-table>
      </as-split-area>
    </as-split>
  </as-split-area>

  <as-split-area [visible]="showRightPanel$ | async" [order]="6" size="15">
    <!-- Selected Point. -->
    <div class="selected-point">
      <ng-container *ngIf="!(selectedPoint$ | async)">
        <mat-card>
          No point is currently selected.
        </mat-card>
      </ng-container>

      <ng-container *ngIf="selectedPoint$ | async">
        <ng-container *ngIf="(selectedPoint$ | async).type === 'activity'">
          <raven-activity-point
            [selectedPoint]="selectedPoint$ | async"
            [showActivityPointMetadata]="showActivityPointMetadata"
            [showActivityPointParameters]="showActivityPointParameters"
            (changeActivityExpansion)="onChangeActivityExpansion($event)"
            (toggleShowActivityPointMetadata)="
              onToggleShowActivityPointMetadata($event)
            "
            (toggleShowActivityPointParameters)="
              onToggleShowActivityPointParameters($event)
            "
          >
          </raven-activity-point>
        </ng-container>

        <ng-container *ngIf="(selectedPoint$ | async).type === 'state'">
          <raven-state-point [selectedPoint]="selectedPoint$ | async">
          </raven-state-point>
        </ng-container>

        <ng-container *ngIf="(selectedPoint$ | async).type === 'resource'">
          <raven-resource-point [selectedPoint]="selectedPoint$ | async">
          </raven-resource-point>
        </ng-container>
      </ng-container>
    </div>
  </as-split-area>
</as-split>

<mat-sidenav-container>
  <!-- Apply Layout Drawer. -->
  <mat-sidenav
    *ngIf="showApplyLayoutDrawer$ | async"
    class="apply-layout-drawer"
    mode="over"
    position="end"
    [fixedInViewport]="true"
    [fixedTopGap]="40"
    [opened]="showApplyLayoutDrawer$ | async"
    (closedStart)="onToggleApplyLayoutDrawer(false)"
  >
    <div class="sidenav-content">
      <button mat-icon-button (click)="onToggleApplyLayoutDrawer(false)">
        <mat-icon aria-label="Clear">
          clear
        </mat-icon>
      </button>
      <raven-layout-apply
        [currentState]="currentState$ | async"
        [currentStateId]="currentStateId$ | async"
        [treeBySourceId]="treeBySourceId$ | async"
        (applyLayout)="onApplyLayout($event)"
        (applyState)="onApplyState($event)"
      >
      </raven-layout-apply>
    </div>
  </mat-sidenav>

  <!-- Global Settings Drawer. -->
  <mat-sidenav
    *ngIf="showGlobalSettingsDrawer$ | async"
    mode="over"
    position="end"
    [fixedInViewport]="true"
    [fixedTopGap]="40"
    [opened]="showGlobalSettingsDrawer$ | async"
    (closedStart)="onToggleGlobalSettingsDrawer(false)"
  >
    <div class="sidenav-content">
      <button mat-icon-button (click)="onToggleGlobalSettingsDrawer(false)">
        <mat-icon aria-label="Clear">
          clear
        </mat-icon>
      </button>
      <raven-settings-global
        [defaultBandSettings]="defaultBandSettings$ | async"
        (updateDefaultBandSettings)="onUpdateDefaultBandSettings($event)"
        (updateTimeline)="onUpdateTimeline($event)"
        (updateBandsActivityFilter)="onUpdateBandsActivityFilter($event)"
      >
      </raven-settings-global>
    </div>
  </mat-sidenav>

  <!-- Epochs Drawer. -->
  <mat-sidenav
    *ngIf="showEpochsDrawer$ | async"
    class="epochs-drawer"
    mode="over"
    position="end"
    [fixedInViewport]="true"
    [fixedTopGap]="40"
    [opened]="showEpochsDrawer$ | async"
    (closedStart)="onToggleEpochsDrawer(false)"
  >
    <div class="sidenav-content">
      <button mat-icon-button (click)="onToggleEpochsDrawer(false)">
        <mat-icon aria-label="Clear">
          clear
        </mat-icon>
      </button>
      <raven-epochs
        [epochs]="epochs$ | async"
        [dayCode]="dayCode$ | async"
        [earthSecToEpochSec]="earthSecToEpochSec$ | async"
        [inUseEpoch]="inUseEpoch$ | async"
        (importEpochs)="onImportEpochs($event)"
        (updateEpochs)="onUpdateEpochs($event)"
      >
      </raven-epochs>
    </div>
  </mat-sidenav>

  <!-- Output Drawer. -->
  <mat-sidenav
    *ngIf="showOutputDrawer$ | async"
    class="output-drawer"
    mode="over"
    position="end"
    [fixedInViewport]="true"
    [fixedTopGap]="40"
    [opened]="showOutputDrawer$ | async"
    (closedStart)="onToggleOutputDrawer(false)"
  >
    <div class="sidenav-content">
      <button mat-icon-button (click)="onToggleOutputDrawer(false)">
        <mat-icon aria-label="Clear">
          clear
        </mat-icon>
      </button>
      <raven-output
        [allInOneFile]="allInOneFile$ | async"
        [allInOneFilename]="allInOneFilename$ | async"
        [decimateOutputData]="decimateOutputData$ | async"
        [filtersByTarget]="filtersByTarget$ | async"
        [outputFormat]="outputFormat$ | async"
        [outputSourceIdsByLabel]="outputSourceIdsByLabel$ | async"
        [subBandSourceIdsByLabel]="subBandSourceIdsByLabel$ | async"
        [treeBySourceId]="treeBySourceId$ | async"
        (createOutput)="onCreateOutput()"
        (updateOutputSettings)="onUpdateOutputSettings($event)"
      >
      </raven-output>
    </div>
  </mat-sidenav>

  <!-- Situational Awareness Drawer. -->
  <mat-sidenav
    *ngIf="showSituationalAwarenessDrawer$ | async"
    class="situational-awareness-drawer"
    mode="over"
    position="end"
    [fixedInViewport]="true"
    [fixedTopGap]="40"
    [opened]="showSituationalAwarenessDrawer$ | async"
    (closedStart)="onToggleSituationalAwarenessDrawer(false)"
  >
    <div class="sidenav-content">
      <button
        mat-icon-button
        (click)="onToggleSituationalAwarenessDrawer(false)"
      >
        <mat-icon class="mat-24" aria-label="Clear">
          clear
        </mat-icon>
      </button>
      <raven-situational-awareness
        [nowMinus]="nowMinus$ | async"
        [nowPlus]="nowPlus$ | async"
        [pageDuration]="pageDuration$ | async"
        [pefEntries]="pefEntries$ | async"
        [situationalAware]="situationalAware$ | async"
        [startTime]="startTime$ | async"
        [useNow]="useNow$ | async"
        (changeSituationalAwareness)="onChangeSituationalAwareness($event)"
        (updateSituationalAwarenessSettings)="
          onUpdateSituationalAwarenessSettings($event)
        "
      >
      </raven-situational-awareness>
    </div>
  </mat-sidenav>

  <!-- Time cursor Drawer. -->
  <mat-sidenav
    *ngIf="showTimeCursorDrawer$ | async"
    class="time-cursor-drawer"
    mode="over"
    position="end"
    [fixedInViewport]="true"
    [fixedTopGap]="40"
    [opened]="showTimeCursorDrawer$ | async"
    (closedStart)="onToggleTimeCursorDrawer(false)"
  >
    <div class="sidenav-content">
      <button mat-icon-button (click)="onToggleTimeCursorDrawer(false)">
        <mat-icon aria-label="Clear">
          clear
        </mat-icon>
      </button>
      <raven-time-cursor
        [autoPage]="autoPage$ | async"
        [clockRate]="clockRate$ | async"
        [currentTimeDelta]="currentTimeDelta$ | async"
        [cursorColor]="cursorColor$ | async"
        [cursorTime]="cursorTime$ | async"
        [cursorWidth]="cursorWidth$ | async"
        [showTimeCursor]="showTimeCursor$ | async"
        [setCursorTime]="setCursorTime$ | async"
        (displayTimeCursor)="onDisplayTimeCursor($event)"
        (updateTimeCursorSettings)="onUpdateTimeCursorSettings($event)"
      >
      </raven-time-cursor>
    </div>
  </mat-sidenav>
</mat-sidenav-container>
