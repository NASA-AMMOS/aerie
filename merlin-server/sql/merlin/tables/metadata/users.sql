create table metadata.users(
  id integer generated by default as identity primary key,
  username text not null unique,
  default_role text not null references metadata.user_roles
    on update cascade
    on delete restrict
);
-- Insert the default roles into the table, then change the generated status to "Always"
-- This can be changed back if we need to add more default users in the future
insert into metadata.users(id, username, default_role)
  values (-1, 'Mission Model', 'viewer'),
         (-2, 'Aerie Legacy', 'viewer');
alter table metadata.users
  alter id set generated always;

comment on table metadata.users is e''
'All users recognized by this deployment.';
comment on column metadata.users.id is e''
'The unique identifier for this user.';
comment on column metadata.users.username is e''
'The user''s username. No two users may share a username.';
comment on column metadata.users.default_role is e''
'The user''s default role for making Hasura requests.';
